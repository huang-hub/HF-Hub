---
import { getEnv } from '../../lib/env'
import voidFile from '../../assets/void.png'
import List from '../../components/list.astro'
import { getChannelInfo } from '../../lib/telegram'
const { SITE_URL } = Astro.locals
const channelInfo = await getChannelInfo(Astro)
const post = await getChannelInfo(Astro, {
  type: 'post',
  id: Astro.params.id,
})
const channel = {
  ...(channelInfo || {}),
  posts: [post],
  seo: post,
}
const staticProxy = getEnv(import.meta.env, Astro, 'STATIC_PROXY') ?? '/static/'
export const prerender = false
---

<html>
  <head>
    <title>{post.title.slice(0, 60)}</title>
    <meta name="description" content={post.description.slice(0, 160)}>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  </head>
  <body>
    <List channel={channel} before={false} after={false}>
      <div slot="header" id="breadcrumb">
        <img
          src={channel?.avatar?.startsWith('http')
            ? staticProxy + channel?.avatar
            : voidFile.src}
          alt={channel?.title}
          loading="eager"
          class="breadcrumb-avatar"
        />
        <div class="breadcrumb-title">
          <a href={SITE_URL} class="site-title" title={channel?.title}>
            {channel.title}
          </a>
        </div>
      </div>
    </List>
  </body>
</html>
